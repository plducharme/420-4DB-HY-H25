<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html class="no-js" lang="en">

<head>
<meta http-equiv="Content-Language" content="en-us"/>
<meta http-equiv="Content-Type" content="text/html; charset=windows-1252"/>
<meta http-equiv="X-UA-Compatible" content="IE=9" />
<link rel="SHORTCUT ICON" href="/favicon.ico"/>

<meta content="width=device-width, initial-scale=1.0" name="viewport" />
<title>Storing passwords in a secure way in a SQL Server database</title>
<meta name="description" content="In this tip we look at how to safely store passwords in a SQL Server database."/>
<link rel="canonical" href="https://www.mssqltips.com/sqlservertip/4037/storing-passwords-in-a-secure-way-in-a-sql-server-database/" />



<link href="https://www.mssqltips.com/css/foundation2.css" rel="stylesheet" />
<link href="https://www.mssqltips.com/css/app.css" rel="stylesheet" />
<script src="https://www.mssqltips.com/js/vendor/modernizr.js"></script>
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>




<script type='text/javascript'>
var googletag = googletag || {};
googletag.cmd = googletag.cmd || [];
(function() {
var gads = document.createElement('script');
gads.async = true;
gads.type = 'text/javascript';
var useSSL = 'https:' == document.location.protocol;
gads.src = (useSSL ? 'https:' : 'http:') +
'//www.googletagservices.com/tag/js/gpt.js';
var node = document.getElementsByTagName('script')[0];
node.parentNode.insertBefore(gads, node);
})();
</script>


<script type='text/javascript'>
var gptAdSlots = [];
googletag.cmd.push(function() {

var mapping = googletag.sizeMapping().

addSize([100, 100], []).
addSize([320, 400], []).
addSize([320, 700], []).
addSize([750, 200], [728, 90]).
addSize([1050, 200], [728, 90]).build();

 googletag.defineSlot('/53998264/160x600-Primary', [160, 600], 'div-gpt-ad-1388505177750-0').addService(googletag.pubads());  googletag.defineSlot('/53998264/160x600-Secondary', [160, 600], 'div-gpt-ad-1388505177750-1').addService(googletag.pubads());  googletag.defineSlot('/53998264/300x250-Primary', [300, 250], 'div-gpt-ad-1388505177750-2').addService(googletag.pubads());  googletag.defineSlot('/53998264/300x250-Secondary', [300, 250], 'div-gpt-ad-1388505177750-3').addService(googletag.pubads());  
	gptAdSlots[0] = googletag.defineSlot('/53998264/728x90-Primary', [728, 90], 'ad-slot-leader').
	defineSizeMapping(mapping).
	addService(googletag.pubads());

	googletag.defineSlot('/53998264/TextAd-Position1', [790, 20], 'div-gpt-ad-1388505177750-12').addService(googletag.pubads());
	googletag.defineSlot('/53998264/TextAd-Position2', [790, 20], 'div-gpt-ad-1388505177750-13').addService(googletag.pubads());
	googletag.defineSlot('/53998264/TextAd-Position3', [790, 20], 'div-gpt-ad-1388505177750-14').addService(googletag.pubads());
	googletag.defineSlot('/53998264/TextAd-Position4', [790, 20], 'div-gpt-ad-1388505177750-15').addService(googletag.pubads());
	googletag.defineSlot('/53998264/TextAd-Position5', [790, 20], 'div-gpt-ad-1388505177750-16').addService(googletag.pubads());


googletag.pubads().enableSingleRequest();
googletag.pubads().collapseEmptyDivs();
googletag.enableServices();
});
</script>


</head>

<body>
<a name="top"></a>

<!-- Start Alexa Certify Javascript -->
<script type="text/javascript">
_atrk_opts = { atrk_acct:"oydse1a8gR00wM", domain:"mssqltips.com",dynamic: true};
(function() { var as = document.createElement('script'); as.type = 'text/javascript'; as.async = true; as.src = "https://d31qbv1cthcecs.cloudfront.net/atrk.js"; var s = document.getElementsByTagName('script')[0];s.parentNode.insertBefore(as, s); })();
</script>
<noscript><img src="https://d5nxst8fruw4z.cloudfront.net/atrk.gif?account=oydse1a8gR00wM" style="display:none" height="1" width="1" alt="" /></noscript>
<!-- End Alexa Certify Javascript -->


	<div class="row">
		<div class="large-12 columns text-center">
		<br />
		<a onclick="_gaq.push(['_trackEvent', '990x30', 'Click', 'Top']);" target="_blank" href="/ss.asp?id=3112&link=https://ad.doubleclick.net/ddm/clk/314044174;141836618;b"><img src="https://www.mssqltips.com/absolutebm/banners/MSSQLTips_Webcast_20161122_990x30.png" border="0" height="30" width="990" alt="Learn more about SQL Server tools"></a>
		<br /><br />
		</div>
	</div>


<div class="row">
	<div class="large-2 columns text-center">
		<a href="https://www.mssqltips.com/"><img src="https://www.mssqltips.com/images/mslogo_113x60.gif" /></a>
	</div>
	
	<div class="large-8 hide-for-print columns">
		<div style="padding:10px; background-color:#DADADA">
		<div style="padding: 5px; background-color:#FFFFFF">
			<script>
			  (function() {
				var cx = '004111219998430415686:pjndvj5e2n4';
				var gcse = document.createElement('script');
				gcse.type = 'text/javascript';
				gcse.async = true;
				gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
				'//cse.google.com/cse/cse.js?cx=' + cx;
				var s = document.getElementsByTagName('script')[0];
				s.parentNode.insertBefore(gcse, s);
			  })();
			</script>
			<gcse:searchbox-only resultsUrl="/search/" newWindow="false" queryParameterName="q"></gcse:searchbox-only>
		</div>
		</div>
	</div>	
	
	<div class="large-2 columns hide-for-small hide-for-print text-center">
		<a href="https://www.mssqltips.com/sqlservertip/4277/mssqltipscom-10-year-anniversary-celebration/"><img src="https://www.mssqltips.com/images/ten-year-anniversary.png" /></a>
	</div>
</div>
<div class="row">
	<div class="large-12 columns text-center">
		&nbsp;
	</div>
</div>
<div class="row" style="background-color:#3B6D93;">
	<div class="large-12 columns text-center hide-for-medium hide-for-small hide-for-print">
		<h3 style="text-align:center; color:white; padding:5px 0 0 0;">
		<a onclick="_gaq.push(['_trackEvent', 'Menu_20160204', 'Click', 'Tutorials_l']);" href="https://www.mssqltips.com/sql-server-tutorials/" style="text-decoration:none;color:white">Tutorials</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		<a onclick="_gaq.push(['_trackEvent', 'Menu_20160204', 'Click', 'DBA_l']);" href="https://www.mssqltips.com/sql-server-dba-resources/" style="text-decoration:none;color:white">DBA</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		<a onclick="_gaq.push(['_trackEvent', 'Menu_20160204', 'Click', 'Dev_l']);" href="https://www.mssqltips.com/sql-server-developer-resources/" style="text-decoration:none;color:white">Dev</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		<a onclick="_gaq.push(['_trackEvent', 'Menu_20160204', 'Click', 'BI_l']);" href="https://www.mssqltips.com/sql-server-business-intelligence-resources/" style="text-decoration:none;color:white">BI</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		<a onclick="_gaq.push(['_trackEvent', 'Menu_20160204', 'Click', 'Career_l']);" href="https://www.mssqltips.com/sql-server-professional-development-resources/" style="text-decoration:none;color:white">Career</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		<a onclick="_gaq.push(['_trackEvent', 'Menu_20160204', 'Click', 'Categories_l']);" href="https://www.mssqltips.com/sql-server-categories/" style="text-decoration:none;color:white">Categories</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		<a onclick="_gaq.push(['_trackEvent', 'Menu_20160204', 'Click', 'Webcasts_l']);" href="https://www.mssqltips.com/sql-server-webcasts/" style="text-decoration:none;color:white">Events</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;		
		<a onclick="_gaq.push(['_trackEvent', 'Menu_20160204', 'Click', 'Whitepapers_l']);" href="https://www.mssqltips.com/sql-server-whitepapers/" style="text-decoration:none;color:white">Whitepapers</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;		
		<a onclick="_gaq.push(['_trackEvent', 'Menu_20160204', 'Click', 'TodaysTip_l']);" href="https://www.mssqltips.com/todays-sql-server-tip/" style="text-decoration:none;color:white">Today's&nbsp;Tip</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;		
		<a onclick="_gaq.push(['_trackEvent', 'Menu_20160204', 'Click', 'Join_l']);" href="https://www.mssqltips.com/get-free-sql-server-tips/?ref=JoinHeaderMenu" style="text-decoration:none;color:white">Join</a>
		</h3>
	</div>
</div>
<div class="row" style="background-color:#3B6D93;">
	<div class="large-12 columns text-center hide-for-large hide-for-small hide-for-print">
		<h3 style="text-align:center; color:white; padding:5px 0 0 0;">
		<a onclick="_gaq.push(['_trackEvent', 'Menu_20160204', 'Click', 'Tutorials_m']);" href="https://www.mssqltips.com/sql-server-tutorials/" style="text-decoration:none;color:white">Tutorials</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		<a onclick="_gaq.push(['_trackEvent', 'Menu_20160204', 'Click', 'DBA_m']);" href="https://www.mssqltips.com/sql-server-dba-resources/" style="text-decoration:none;color:white">DBA</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		<a onclick="_gaq.push(['_trackEvent', 'Menu_20160204', 'Click', 'Dev_m']);" href="https://www.mssqltips.com/sql-server-developer-resources/" style="text-decoration:none;color:white">Dev</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		<a onclick="_gaq.push(['_trackEvent', 'Menu_20160204', 'Click', 'BI_m']);" href="https://www.mssqltips.com/sql-server-business-intelligence-resources/" style="text-decoration:none;color:white">BI</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;		
		<a onclick="_gaq.push(['_trackEvent', 'Menu_20160204', 'Click', 'Categories_m']);" href="https://www.mssqltips.com/sql-server-categories/" style="text-decoration:none;color:white">Categories</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		<a onclick="_gaq.push(['_trackEvent', 'Menu_20160204', 'Click', 'Webcasts_m']);" href="https://www.mssqltips.com/sql-server-webcasts/" style="text-decoration:none;color:white">Events</a>
		</h3>
	</div>
</div>
<div class="row" style="background-color:#3B6D93;">
	<div class="large-12 columns text-center hide-for-medium hide-for-large hide-for-print">
		<h3 style="text-align:center; color:white; padding:5px 0 0 0;">
		<a onclick="_gaq.push(['_trackEvent', 'Menu_20160204', 'Click', 'DBA_s']);" href="https://www.mssqltips.com/sql-server-dba-resources/" style="text-decoration:none;color:white">DBA</a>&nbsp;&nbsp;&nbsp;
		<a onclick="_gaq.push(['_trackEvent', 'Menu_20160204', 'Click', 'Dev_s']);" href="https://www.mssqltips.com/sql-server-developer-resources/" style="text-decoration:none;color:white">Dev</a>&nbsp;&nbsp;&nbsp;
		<a onclick="_gaq.push(['_trackEvent', 'Menu_20160204', 'Click', 'BI_s']);" href="https://www.mssqltips.com/sql-server-business-intelligence-resources/" style="text-decoration:none;color:white">BI</a>&nbsp;&nbsp;&nbsp;
		<a onclick="_gaq.push(['_trackEvent', 'Menu_20160204', 'Click', 'Categories_s']);" href="https://www.mssqltips.com/sql-server-categories/" style="text-decoration:none;color:white">Categories</a>
		</h3>
	</div>
</div>
<div class="row">
	&nbsp;
</div>





<div class="row">

	 <div class="large-9 columns" role="content">  <h1>Storing passwords in a secure way in a SQL Server database</h1> 
			<div align="center" class="hide-for-print">
				<br />
				<div id="ad-slot-leader" style="height:150px;">
				   <script>
					 googletag.cmd.push(function() {googletag.display('ad-slot-leader'); });
				   </script>
				</div>
			</div>
		


<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.5";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



<article>
		
		<span class="hide-for-small"><h6>By: <a href="/sqlserverauthor/175/sergey-gigoyan/" rel="author" title="author profile for Sergey Gigoyan">Sergey Gigoyan</a> &nbsp;&nbsp;|&nbsp;&nbsp; <a href="#comments" title="read and post comments">Read Comments (28)</a> &nbsp;&nbsp;|&nbsp;&nbsp; Related Tips: <a href="/sqlservertip/4037/storing-passwords-in-a-secure-way-in-a-sql-server-database/">1</a> | <a href="/sqlservertip/4260/storing-passwords-in-sql-server--things-to-know-to-keep-the-data-secure/">2</a> | <a href="/sqlservertip/2708/tracking-login-password-changes-in-sql-server/">3</a> | <a href="/sql-server-developer-resources/">More</a> > <a href="/sql-server-tip-category/68/encryption/">Encryption </a></h6></span>
		<br />
		
		<h5>Problem</h5>

<p>Everybody  would agree that passwords should be secure, so users should 
consider these points when they choose passwords. Such as using a mix of 
characters and special symbols, not using simple 
words, using a combination of special symbols, letters and numbers, etc. But all these 
considerations are not enough if passwords are stored in an unsecure way. </p>
<p>In database 
applications passwords are usually stored in the database, so storing passwords in the 
database should be implemented very carefully. It is obvious that storing passwords 
in the table with plain text is very vulnerable, because if an attacker accesses the 
database he/she can steal users' passwords. It is indisputable that passwords in 
a database 
should be encrypted and made undecipherable as much as possible.</p>
<h5>Solution</h5>

<p>Let's see how to encrypt and store passwords in a SQL Server database. For encrypting passwords
we'll use one-way hashing algorithms. These algorithms map the input value to encrypted output 
and for the same input it generates the same output text. Also there is no decryption 
algorithm. It means that it's impossible to revert to the original value using encrypted output. 
</p>
<p>The HASHBYTES function in  SQL Server returns a hash for the input value generated with 
a given algorithm. 
Possible algorithms for this function are MD2, MD4, MD5, SHA, SHA1 and starting 
with SQL Server 2012 also include
SHA2_256 and SHA2_512. We will choose the strongest - SHA2_512 - for our example (it generates 
a 130 
symbol hash and uses 64 bytes). We  should also consider the fact that the stronger algorithm, 
the more time that is needed for 
hashing than for weaker algorithms. </p>
<p>Let's assume that we need to create table which stores user's data such as:</p>
<div class="codediv">
	<pre>

CREATE TABLE dbo.[User]
(
    UserID INT IDENTITY(1,1) NOT NULL,
    LoginName NVARCHAR(40) NOT NULL,
    PasswordHash BINARY(64) NOT NULL,
    FirstName NVARCHAR(40) NULL,
    LastName NVARCHAR(40) NULL,
    CONSTRAINT [PK_User_UserID] PRIMARY KEY CLUSTERED (UserID ASC)
)
	</pre>
</div>


<p>Also we will create a stored procedure to insert user's data (we developed 
this stored procedure in the
simplest way to illustrate this example, but in reality these kind of procedures contain more complicated code):</p>
<div class="codediv">
	<pre>
CREATE PROCEDURE dbo.uspAddUser
    @pLogin NVARCHAR(50), 
    @pPassword NVARCHAR(50), 
    @pFirstName NVARCHAR(40) = NULL, 
    @pLastName NVARCHAR(40) = NULL,
    @responseMessage NVARCHAR(250) OUTPUT
AS
BEGIN
    SET NOCOUNT ON

    BEGIN TRY

        INSERT INTO dbo.[User] (LoginName, PasswordHash, FirstName, LastName)
        VALUES(@pLogin, HASHBYTES('SHA2_512', @pPassword), @pFirstName, @pLastName)

        SET @responseMessage='Success'

    END TRY
    BEGIN CATCH
        SET @responseMessage=ERROR_MESSAGE() 
    END CATCH

END
	</pre>
</div>		


<p>As we can see, the stored procedure takes the password as an input parameter and inserts it into the database 
in an encrypted form - HASHBYTES('SHA2_512', @pPassword). We can run the stored procedure 
as follows:
</p>
<div class="codediv">
	<pre>
DECLARE @responseMessage NVARCHAR(250)

EXEC dbo.uspAddUser
          @pLogin = N'Admin',
          @pPassword = N'123',
          @pFirstName = N'Admin',
          @pLastName = N'Administrator',
          @responseMessage=@responseMessage OUTPUT

SELECT *
FROM [dbo].[User]
	</pre>
</div>	
<br />
<div class="imageborder">
	<img alt="encrypted password" src="/tipimages2/4037_1_password.jpg" />
</div>
<p>As we can see the password's text is unreadable. However encrypting passwords is not a 100% guarantee 
that passwords can't be cracked. They can be vulnerable to some attacks (dictionary, rainbow 
tables, etc.). One of the simple examples of this sort of cracking is that attackers can generate hashes for the group of simple, 
common passwords and store this "password-hash" mapping in the table. Thus using this table they can try to crack users' passwords by comparing hashes 
from that mapping table with the password hashes of users in case users' data becomes available for the attacker. The weaker the password is 
(simple, small, etc.), the   easier it can be cracked. So, using strong passwords and using 
the strongest 
encryption algorithm will minimize the risks. </p>
<p>There is also a way to make a stronger hash, even if the user 
chooses 
a weak password. It is a hash generated from the combination of a password and randomly generated text. 
This randomly generated text is called a salt in cryptography. In this case the attacker should spend incomparably 
more time, because he/she should also consider the salt for cracking. Salt 
should be unique for each user, otherwise if two different users have the same 
password, their password hashes also will be the same and if their salts are the 
same, it means that the hashed password string for these users will be the same, 
which is risky because after cracking one of the passwords the attacker will 
know the other password too.  By using different salts for each user,  
we can avoid  these kinds of situations.</p>
<p>Let's alter our table and the stored procedure to use a salt in the password encryption. 
We use UNIQUEIDENTIFIER for a salt, because it's randomly generated and a unique string.</p>
<div class="codediv">
	<pre>
ALTER TABLE dbo.[User] ADD Salt UNIQUEIDENTIFIER 
GO

ALTER PROCEDURE dbo.uspAddUser
    @pLogin NVARCHAR(50), 
    @pPassword NVARCHAR(50),
    @pFirstName NVARCHAR(40) = NULL, 
    @pLastName NVARCHAR(40) = NULL,
    @responseMessage NVARCHAR(250) OUTPUT
AS
BEGIN
    SET NOCOUNT ON

    DECLARE @salt UNIQUEIDENTIFIER=NEWID()
    BEGIN TRY

        INSERT INTO dbo.[User] (LoginName, PasswordHash, Salt, FirstName, LastName)
        VALUES(@pLogin, HASHBYTES('SHA2_512', @pPassword+CAST(@salt AS NVARCHAR(36))), @salt, @pFirstName, @pLastName)

       SET @responseMessage='Success'

    END TRY
    BEGIN CATCH
        SET @responseMessage=ERROR_MESSAGE() 
    END CATCH

END
	</pre>
</div>

<p>Then we truncate the table and run the procedure again:

</p>

<div class="codediv">
	<pre>
TRUNCATE TABLE [dbo].[User]

DECLARE @responseMessage NVARCHAR(250)

EXEC dbo.uspAddUser
          @pLogin = N'Admin',
          @pPassword = N'123',
          @pFirstName = N'Admin',
          @pLastName = N'Administrator',
          @responseMessage=@responseMessage OUTPUT

SELECT UserID, LoginName, PasswordHash, Salt, FirstName, LastName
FROM [dbo].[User]
	</pre>
</div>

<p>And the result will be as follows:
</p>
<br></br>
<div class="imageborder">
	<img alt="encrypted password with salt" src="/tipimages2/4037_2_passwords.jpg" />
</div>
<br />
<p>Please note, that salt is stored in the table with plain-text, there is no reason to encrypt it.
Now let's create a simple procedure to authenticate the user using an encrypted password with 
the salt:

</p>

<div class="codediv">
	<pre>
CREATE PROCEDURE dbo.uspLogin
    @pLoginName NVARCHAR(254),
    @pPassword NVARCHAR(50),
    @responseMessage NVARCHAR(250)='' OUTPUT
AS
BEGIN

    SET NOCOUNT ON

    DECLARE @userID INT

    IF EXISTS (SELECT TOP 1 UserID FROM [dbo].[User] WHERE LoginName=@pLoginName)
    BEGIN
        SET @userID=(SELECT UserID FROM [dbo].[User] WHERE LoginName=@pLoginName AND PasswordHash=HASHBYTES('SHA2_512', @pPassword+CAST(Salt AS NVARCHAR(36))))

       IF(@userID IS NULL)
           SET @responseMessage='Incorrect password'
       ELSE 
           SET @responseMessage='User successfully logged in'
    END
    ELSE
       SET @responseMessage='Invalid login'

END
	</pre>
</div>		

<p>And we can test it as follows:

</p>

<div class="codediv">
	<pre>
DECLARE	@responseMessage nvarchar(250)

--Correct login and password
EXEC	dbo.uspLogin
		@pLoginName = N'Admin',
		@pPassword = N'123',
		@responseMessage = @responseMessage OUTPUT

SELECT	@responseMessage as N'@responseMessage'

--Incorrect login
EXEC	dbo.uspLogin
		@pLoginName = N'Admin1', 
		@pPassword = N'123',
		@responseMessage = @responseMessage OUTPUT

SELECT	@responseMessage as N'@responseMessage'

--Incorrect password
EXEC	dbo.uspLogin
		@pLoginName = N'Admin', 
		@pPassword = N'1234',
		@responseMessage = @responseMessage OUTPUT

SELECT	@responseMessage as N'@responseMessage'
	</pre>
</div>
<br />
<div class="imageborder">
	<img alt="test encrypted password storage" src="/tipimages2/4037_3_password_testing.jpg" />
</div>


<h5>Conclusion</h5>

<p>Storing passwords in an encrypted way in the database and using unique salts 
for passwords, decreases the risks that passwords can be cracked. The SQL Server UNIQUEIDENTIFIER 
data type is a good candidate for a salt taking into consideration its uniqueness and randomness.</p>
<h5>Next Steps</h5>

<ul>
  <li>
   Read more tips and articles<ul>
	   <li>
	   <a href="https://msdn.microsoft.com/en-us/library/ms174415.aspx" target="_blank">https://msdn.microsoft.com/en-us/library/ms174415.aspx
 	  </a></li>
	   <li>
	   <a href="https://msdn.microsoft.com/en-us/library/ms187942.aspx" target="_blank">https://msdn.microsoft.com/en-us/library/ms187942.aspx
 	  </a></li>
	   <li>
	   <a href="/sql-server-tip-category/68/encryption/">
	   Encryption Tips</a></li>
   </ul>
  </li>
</ul>

		<br /><br />
		
		Last Update: <span itemprop="datePublished">9/29/2015</span>
		<br /><br /><br />

		<div class="row">
			<div class="large-6 columns">
				<div align="center" class="hide-for-print"><a href="https://www.mssqltips.com/get-free-sql-server-tips/?ref=yellow" onclick="_gaq.push(['_trackEvent', 'Join', 'Click', 'YellowButton']);"><img border="0" src="/images/getfreesqltips_red_20160929.png" alt="" width="300" height="150" ></a></div>
				<br />
			</div>
			<div class="large-6 columns">
				<div align="center" class="hide-for-print"><a href="/sqlservertip/4260/storing-passwords-in-sql-server--things-to-know-to-keep-the-data-secure/" onclick="_gaq.push(['_trackEvent', 'NextTip', 'Click', 'YellowArrow']);"><img border="0" src="/images/nav_nexttip_clickhere_rev1.png" alt="" width="300" height="150" ></a></div>
				<br />
			</div>
		</div>
		<br /><br />

		<h5>About the author</h5>
		<div class="row">
			<div class="large-6 columns">
			<a href="/sqlserverauthor/175/sergey-gigoyan/"><span itemprop="image"><img style="float: left; padding: 0px 3px 0px 0px;" alt="MSSQLTips author Sergey Gigoyan" height="90" src="/images/Sergey-Gigoyan.jpg" width="60" /></span></a>

			Sergey Gigoyan is a database professional with more than 6 years of experience, with a focus on database design, development, performance tuning, optimization, high availability, BI and DW design.
			<br /><br /><b><a href="/sqlserverauthor/175/sergey-gigoyan/">View all my tips</a></b>
			</div>

			<div class="large-6 columns">
			
	<b>Related Resources</b><br />
	<ul>
<li><a href="/sqlservertip/4037/storing-passwords-in-a-secure-way-in-a-sql-server-database/" title="Storing passwords in a secure way in a SQL Server database">Storing passwords in a secure way in a SQL Server ...</a></li><li><a href="/sqlservertip/4260/storing-passwords-in-sql-server--things-to-know-to-keep-the-data-secure/" title="Storing passwords in SQL Server – things to know to keep the data secure">Storing passwords in SQL Server – things to know t...</a></li><li><a href="/sqlservertip/2708/tracking-login-password-changes-in-sql-server/" title="Tracking Login Password Changes in SQL Server">Tracking Login Password Changes in SQL Server...</a></li><li><a href="/sql-server-developer-resources/">More Database Developer Tips...</a></li>

	</ul>

			</div>
		</div>
		<br /><br />

<a name="comments"></a>
		<div class="row hide-for-small hide-for-print">
			<div class="large-2 columns">
				<script src="//platform.linkedin.com/in.js" type="text/javascript"></script><script type="IN/Share" data-counter="right"></script>
			</div>
			<div class="large-2 columns">
				<div class="fb-like" data-href="https://www.mssqltips.com/sqlservertip/4037/storing-passwords-in-a-secure-way-in-a-sql-server-database/" data-layout="button_count" data-width="50" data-action="like" data-show-faces="false"></div>
			</div>

			<div class="large-2 columns">
				&nbsp;
			</div>
			<div class="large-2 columns">
				<!-- Place this tag where you want the +1 button to render -->
				<g:plusone size="medium" annotation="inline" width="120"></g:plusone>
				<!-- Place this render call where appropriate -->
				<script type="text/javascript">
				  (function() {
				    var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
				    po.src = 'https://apis.google.com/js/plusone.js';
				    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
				  })();
				</script>
			</div>
			<div class="large-4 columns">
				<a href="/contribute/">Become a paid author</a>
			</div>
		<hr />
		</div>
		<br /><br />

</article>




		<div class="row">

			

		</div>

		
		<div class="hide-for-print">
			<div class="hide-for-small" style='text-align: center; color: orange; font-weight: bold; font-size:24px;'>More SQL Server Solutions</div>
<br />
<div class="hide-for-small" style="border-top: orange 5px solid; border-bottom: orange 5px solid;">

	<!-- TextAd-Position1 -->
	<div id='div-gpt-ad-1388505177750-12' style='width:100%; height:30px; background:#f7f3f2; padding-top:10px; padding-left:10px;'>
	<script type='text/javascript'>
	googletag.cmd.push(function() { googletag.display('div-gpt-ad-1388505177750-12'); });
	</script>
	</div>

	<!-- TextAd-Position2 -->
	<div id='div-gpt-ad-1388505177750-13' style='width:100%; height:30px; padding-top:10px; padding-left:10px;'>
	<script type='text/javascript'>
	googletag.cmd.push(function() { googletag.display('div-gpt-ad-1388505177750-13'); });
	</script>
	</div>

	<!-- TextAd-Position3 -->
	<div id='div-gpt-ad-1388505177750-14' style='width:100%; height:30px; background:#f7f3f2; padding-top:10px; padding-left:10px;'>
	<script type='text/javascript'>
	googletag.cmd.push(function() { googletag.display('div-gpt-ad-1388505177750-14'); });
	</script>
	</div>

	<!-- TextAd-Position4 -->
	<div id='div-gpt-ad-1388505177750-15' style='width:100%; height:30px; padding-top:10px; padding-left:10px;'>
	<script type='text/javascript'>
	googletag.cmd.push(function() { googletag.display('div-gpt-ad-1388505177750-15'); });
	</script>
	</div>

	<!-- TextAd-Position5 -->
	<div id='div-gpt-ad-1388505177750-16' style='width:100%; height:30px; background:#f7f3f2; padding-top:10px; padding-left:10px;'>
	<script type='text/javascript'>
	googletag.cmd.push(function() { googletag.display('div-gpt-ad-1388505177750-16'); });
	</script>
	</div>
</div>
<div class="hide-for-small">
	<br />
	<br />
	<br />
</div>


		</div>
		
		<div class="hide-for-print">
			
			<a name="commentnew"></a>
			<a name="comments2"></a>




<script language="javascript">
function RefreshImage(valImageId) {
	var objImage = document.images[valImageId];
	if (objImage == undefined) {
		return;
	}
	var now = new Date();
	objImage.src = objImage.src.split('?')[0] + '?x=' + now.toUTCString();
}
</script>

<script language = "Javascript">
/**
 * DHTML email validation script. Courtesy of SmartWebby.com (http://www.smartwebby.com/dhtml/)
 */

function echeck(str) {

		var at="@"
		var dot="."
		var lat=str.indexOf(at)
		var lstr=str.length
		var ldot=str.indexOf(dot)
		if (str.indexOf(at)==-1){
		   alert("Invalid E-mail")
		   return false
		}

		if (str.indexOf(at)==-1 || str.indexOf(at)==0 || str.indexOf(at)==lstr){
		   alert("Invalid E-mail")
		   return false
		}

		if (str.indexOf(dot)==-1 || str.indexOf(dot)==0 || str.indexOf(dot)==lstr){
		    alert("Invalid E-mail")
		    return false
		}

		 if (str.indexOf(at,(lat+1))!=-1){
		    alert("Invalid E-mail")
		    return false
		 }

		 if (str.substring(lat-1,lat)==dot || str.substring(lat+1,lat+2)==dot){
		    alert("Invalid E-mail")
		    return false
		 }

		 if (str.indexOf(dot,(lat+2))==-1){
		    alert("Invalid E-mail")
		    return false
		 }
		
		 if (str.indexOf(" ")!=-1){
		    alert("Invalid E-mail")
		    return false
		 }

 		 return true					
	}

function ValidateForm(){
	var emailID=document.comment.email
	var name=document.comment.name
	var captchacode=document.comment.captchacode


	if ((name.value==null)||(name.value=="")){
		alert("Please Enter your Name")
		name.focus()
		return false
	}	
	if ((emailID.value==null)||(emailID.value=="")){
		alert("Please Enter your Email")
		emailID.focus()
		return false
	}
	if (echeck(emailID.value)==false){
		emailID.focus()
		return false
	}
	if ((captchacode.value==null)||(captchacode.value=="")){
		alert("Please Enter Code")
		captchacode.focus()
		return false
	}
	return true
 }
</script>
<!-- TinyMCE -->
<script type="text/javascript" src="/tinymce2/js/tinymce/tinymce.min.js"></script>
<script type="text/javascript">
tinymce.init({
    selector: "textarea",
    menubar: false,
    plugins: "preview",
    toolbar: "undo redo | bold italic | bullist numlist outdent indent | link | preview"
});
</script>

<!-- /TinyMCE -->
<form name="comment" action="https://www.mssqltips.com/sqlservertip/4037/storing-passwords-in-a-secure-way-in-a-sql-server-database/#comments2" method="post" onSubmit="return ValidateForm()">
<input type=hidden name="tipid" value="4037">
<input type=hidden name="CanonicalComment" value="">
	<div>

		<!-- Gets replaced with TinyMCE, remember HTML in a textarea should be encoded -->
		<div style="background-color:#E2E2E2; padding:10px;">
			<h5><span style="color:#000080">Post a comment or let the author know this tip helped.</span></h5>
			<p>All comments are reviewed, so stay on subject or we may delete your comment.  Note: your email address is not published. Required fields are marked with an asterisk (*).</p>

					*Name&nbsp;<input type="text" name="name" size="30" value="">&nbsp;&nbsp;
					*Email&nbsp;<input type="text" name="email" size="30" value="">&nbsp;&nbsp;
					Notify for updates&nbsp;<input type="checkbox" checked="checked" name="notifyflag" value="-1"><br /><br />
							
					<textarea id="elm1" name="elm1" rows="10" style="width: 100%"><p></p><p></p>*** NOTE *** - If you want to include code from SQL Server Management Studio (SSMS) in your post, please copy the code from SSMS and paste the code into a text editor like NotePad before copying the code below to remove the SSMS formatting.</textarea>
			<br />Get free SQL tips:  <input type="checkbox" name="emailflag" value="1"><br />
			<br/>
			<table>
			<tr>
			<td>
				*Enter Code <input name="captchacode" type="text" id="captchacode" size="10" /> <img id="imgCaptcha" src="/captcha.asp" /> <a href="javascript:void(0)" onclick="RefreshImage('imgCaptcha')"><img border="0" alt="refresh code" src="/images/refresh.png"></a>				
			</td>
			<td>
				&nbsp;&nbsp;&nbsp;&nbsp;<input TYPE="submit" Value="Save Comment"  name="go" class="submit" style="background-color: #000080; color: #FFFFFF; font-size: 18px; font-weight: bold;">
			</td>
			</tr>
			</table>
		
		</div>

	</div>
</form>
		</div>
		
		<div class="hide-for-print">
			





<style type="text/css">
.ForumPostBodyArea
{
	width: 100%;
	vertical-align: top;
	overflow: auto;
}
</style>

<br /><br /><br />

				


					<table border="0" width="100%" cellspacing="0" cellpadding="4" style="border: 1px solid #CBDCED; table-layout: fixed;">
					<tr>
						<td width="80%" bgcolor="#E8F3FF">
							<b>Tuesday, August 30, 2016 - 10:41:08 AM - Suresh</b>
						</td>
						<td style="text-align: right;" bgcolor="#E8F3FF">
							<a title="read the tip" href="#top">Back To Top</a>

						</td>
					</tr>
					<tr>
						<td colspan="2" class="ForumPostBodyArea">
							<p>&nbsp;</p>
<p>&nbsp;Nice article</p>
<p>when i&nbsp; execute the&nbsp;above script the password showed as NULL . i am using sql 2012&nbsp;</p>
						</td>
					</tr>
					</table>
<br>


				


					<table border="0" width="100%" cellspacing="0" cellpadding="4" style="border: 1px solid #CBDCED; table-layout: fixed;">
					<tr>
						<td width="80%" bgcolor="#E8F3FF">
							<b>Wednesday, July 27, 2016 - 12:45:36 AM - sohan yadav</b>
						</td>
						<td style="text-align: right;" bgcolor="#E8F3FF">
							<a title="read the tip" href="#top">Back To Top</a>

						</td>
					</tr>
					<tr>
						<td colspan="2" class="ForumPostBodyArea">
							<p>&nbsp;</p>
<p>create table e1(userid varchar(20),password1 varbinary(max));<br /><br />insert into e1 values('sohan@123',HASHBYTES('sha1','1234'))</p>
<p>&nbsp;</p>
<p>decrpt this password and please provide the query in detail.</p>
<p>Thanks in advance</p>
						</td>
					</tr>
					</table>
<br>


				


					<table border="0" width="100%" cellspacing="0" cellpadding="4" style="border: 1px solid #CBDCED; table-layout: fixed;">
					<tr>
						<td width="80%" bgcolor="#E8F3FF">
							<b>Friday, July 08, 2016 - 10:58:37 PM - Christopher Quinn</b>
						</td>
						<td style="text-align: right;" bgcolor="#E8F3FF">
							<a title="read the tip" href="#top">Back To Top</a>

						</td>
					</tr>
					<tr>
						<td colspan="2" class="ForumPostBodyArea">
							<p>&nbsp;I was just starting to map out my capstone project and was trying to see best way to encrypt users passwords thanks</p>
<p>&nbsp;</p>
<p></p>
						</td>
					</tr>
					</table>
<br>


				


					<table border="0" width="100%" cellspacing="0" cellpadding="4" style="border: 1px solid #CBDCED; table-layout: fixed;">
					<tr>
						<td width="80%" bgcolor="#E8F3FF">
							<b>Wednesday, June 15, 2016 - 2:14:14 PM - Prashant Gupta</b>
						</td>
						<td style="text-align: right;" bgcolor="#E8F3FF">
							<a title="read the tip" href="#top">Back To Top</a>

						</td>
					</tr>
					<tr>
						<td colspan="2" class="ForumPostBodyArea">
							<p>&nbsp;Thanks a lot! Very easily explained and straight forward to implement.</p>
<p>&nbsp;</p>
<p></p>
						</td>
					</tr>
					</table>
<br>


				


					<table border="0" width="100%" cellspacing="0" cellpadding="4" style="border: 1px solid #CBDCED; table-layout: fixed;">
					<tr>
						<td width="80%" bgcolor="#E8F3FF">
							<b>Thursday, May 26, 2016 - 2:10:31 AM - Pablo</b>
						</td>
						<td style="text-align: right;" bgcolor="#E8F3FF">
							<a title="read the tip" href="#top">Back To Top</a>

						</td>
					</tr>
					<tr>
						<td colspan="2" class="ForumPostBodyArea">
							<p>&nbsp;Thank you so much! Awesome step by step!</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p></p>
						</td>
					</tr>
					</table>
<br>


				


					<table border="0" width="100%" cellspacing="0" cellpadding="4" style="border: 1px solid #CBDCED; table-layout: fixed;">
					<tr>
						<td width="80%" bgcolor="#E8F3FF">
							<b>Wednesday, May 11, 2016 - 2:16:04 PM - Paul@Schirf.net</b>
						</td>
						<td style="text-align: right;" bgcolor="#E8F3FF">
							<a title="read the tip" href="#top">Back To Top</a>

						</td>
					</tr>
					<tr>
						<td colspan="2" class="ForumPostBodyArea">
							<p>Another thing to consider is adding another two salt components.&nbsp;&nbsp; First, a component not stored in the DB, but passed into the check routines.&nbsp; I'd suggest a string stored in a config file.&nbsp;&nbsp; Second, include something unique to the row in the salt.&nbsp; Something as simple as the row ID.&nbsp;&nbsp; This prevents developers from simply copying a known password's encrypted value and salt from one row to another to gain access to the target row.</p>
						</td>
					</tr>
					</table>
<br>


				


					<table border="0" width="100%" cellspacing="0" cellpadding="4" style="border: 1px solid #CBDCED; table-layout: fixed;">
					<tr>
						<td width="80%" bgcolor="#E8F3FF">
							<b>Sunday, April 17, 2016 - 8:16:15 AM - Clyde</b>
						</td>
						<td style="text-align: right;" bgcolor="#E8F3FF">
							<a title="read the tip" href="#top">Back To Top</a>

						</td>
					</tr>
					<tr>
						<td colspan="2" class="ForumPostBodyArea">
							<p>Sorry:</p>
<p>Silly question: Answer is: Encode the loginname</p>
						</td>
					</tr>
					</table>
<br>


				


					<table border="0" width="100%" cellspacing="0" cellpadding="4" style="border: 1px solid #CBDCED; table-layout: fixed;">
					<tr>
						<td width="80%" bgcolor="#E8F3FF">
							<b>Sunday, April 17, 2016 - 7:58:04 AM - Clyde</b>
						</td>
						<td style="text-align: right;" bgcolor="#E8F3FF">
							<a title="read the tip" href="#top">Back To Top</a>

						</td>
					</tr>
					<tr>
						<td colspan="2" class="ForumPostBodyArea">
							<p>Hi:</p>
<p>Thank you for this helpful article. It appears however that this approach leaves a glaring security hole; i.e., encodedpasswords passwords of identifiable usernames (say a lower level user) can be copied over an encoded password of an Admin thereby giving an "internal" attacker access to admin level functions if the client application is so designed. Any suggestions?</p>
						</td>
					</tr>
					</table>
<br>


				


					<table border="0" width="100%" cellspacing="0" cellpadding="4" style="border: 1px solid #CBDCED; table-layout: fixed;">
					<tr>
						<td width="80%" bgcolor="#E8F3FF">
							<b>Monday, March 21, 2016 - 1:38:42 PM - Sergey Gigoyan</b>
						</td>
						<td style="text-align: right;" bgcolor="#E8F3FF">
							<a title="read the tip" href="#top">Back To Top</a>

						</td>
					</tr>
					<tr>
						<td colspan="2" class="ForumPostBodyArea">
							<p><span style="color: #222222; font-family: 'Helvetica Neue', Helvetica, Roboto, Arial, sans-serif;"><span style="font-size: 16px; line-height: 25.6px;">Hermawan,</span></span></p>
<p><span style="color: #222222; font-family: 'Helvetica Neue', Helvetica, Roboto, Arial, sans-serif;"><span style="font-size: 16px; line-height: 25.6px;">You cannot decrypt data which has been encrypted using HASHBYTES, it is a one-way encryption.&nbsp;</span></span><span style="color: #222222; font-family: 'Helvetica Neue', Helvetica, Roboto, Arial, sans-serif;"><span style="font-size: 16px; line-height: 25.6px;">You can store answers to questions for password reset in the same way as passwords (one-way encryption using salt), because you will not need to decrypt these answers, you only need to compare them with an answer hash provided by user (like passwords). However you need to show questions to users, so you cannot use one-way encryption for securing questions. In this case you can encrypt questions using symmetric keys, and decrypt them when needed.</span></span></p>
<p><span style="color: #222222; font-family: 'Helvetica Neue', Helvetica, Roboto, Arial, sans-serif;"><span style="font-size: 16px; line-height: 25.6px;">Thanks</span></span></p>
<p>&nbsp;</p>
						</td>
					</tr>
					</table>
<br>


				


					<table border="0" width="100%" cellspacing="0" cellpadding="4" style="border: 1px solid #CBDCED; table-layout: fixed;">
					<tr>
						<td width="80%" bgcolor="#E8F3FF">
							<b>Saturday, March 19, 2016 - 12:27:30 AM - Hermawan</b>
						</td>
						<td style="text-align: right;" bgcolor="#E8F3FF">
							<a title="read the tip" href="#top">Back To Top</a>

						</td>
					</tr>
					<tr>
						<td colspan="2" class="ForumPostBodyArea">
							<p>Nice article. this was i looking for. now password in my database more secure than before. but how to convert from binary values which added along with salt to nvarchar or string that inserted in table user? like 1234. I am developing an application if user forgot the password for instance someone was forgot the password but he/she was already key in recover password such as question and answer to get his/her password. thank you very much.</p>
						</td>
					</tr>
					</table>
<br>


				


					<table border="0" width="100%" cellspacing="0" cellpadding="4" style="border: 1px solid #CBDCED; table-layout: fixed;">
					<tr>
						<td width="80%" bgcolor="#E8F3FF">
							<b>Tuesday, October 13, 2015 - 4:08:19 AM - UnoTurbo</b>
						</td>
						<td style="text-align: right;" bgcolor="#E8F3FF">
							<a title="read the tip" href="#top">Back To Top</a>

						</td>
					</tr>
					<tr>
						<td colspan="2" class="ForumPostBodyArea">
							<p><span style="color: #666666; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;"><span style="font-size: 13px; line-height: 22px;"><strong>BCrypt</strong> is a better choice for storing passwords for many many reasons. &nbsp;The only problem is that SQL Sever doesn't support it. &nbsp;The good news is that you can add it using a CLR function. &nbsp;Here is an article that gives you the CLR and the functions to encrypt and check the encrypted passwords:</span></span></p>
<p><span style="color: #666666; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;"><span style="font-size: 13px; line-height: 22px;">http://blog.tcs.de/using-the-bcrypt-hash-algorithm-in-ms-sql-server/</span></span></p>
						</td>
					</tr>
					</table>
<br>


				


					<table border="0" width="100%" cellspacing="0" cellpadding="4" style="border: 1px solid #CBDCED; table-layout: fixed;">
					<tr>
						<td width="80%" bgcolor="#E8F3FF">
							<b>Monday, October 12, 2015 - 10:14:29 AM - Wim</b>
						</td>
						<td style="text-align: right;" bgcolor="#E8F3FF">
							<a title="read the tip" href="#top">Back To Top</a>

						</td>
					</tr>
					<tr>
						<td colspan="2" class="ForumPostBodyArea">
							<p>U can use a CLR and ecnrypt it like that with SHA2even in older versions of sql server.</p>
						</td>
					</tr>
					</table>
<br>


				


					<table border="0" width="100%" cellspacing="0" cellpadding="4" style="border: 1px solid #CBDCED; table-layout: fixed;">
					<tr>
						<td width="80%" bgcolor="#E8F3FF">
							<b>Friday, October 09, 2015 - 3:11:22 PM - Sergey Gigoyan</b>
						</td>
						<td style="text-align: right;" bgcolor="#E8F3FF">
							<a title="read the tip" href="#top">Back To Top</a>

						</td>
					</tr>
					<tr>
						<td colspan="2" class="ForumPostBodyArea">
							<p><span style="font-size: 13.3333px;">I agree Steve, of course the security can be increased the way you suggested. I just chose to address &nbsp;only database side security in this article.</span></p>
<p class="MsoNormal">&nbsp;</p>
						</td>
					</tr>
					</table>
<br>


				


					<table border="0" width="100%" cellspacing="0" cellpadding="4" style="border: 1px solid #CBDCED; table-layout: fixed;">
					<tr>
						<td width="80%" bgcolor="#E8F3FF">
							<b>Friday, October 09, 2015 - 8:58:36 AM - Steve Hood</b>
						</td>
						<td style="text-align: right;" bgcolor="#E8F3FF">
							<a title="read the tip" href="#top">Back To Top</a>

						</td>
					</tr>
					<tr>
						<td colspan="2" class="ForumPostBodyArea">
							<p>Wouldn't you want to do the encryption on the application layer to avoid the password being visible as much as possible?&nbsp; For instance, we're encrypting it at rest so if someone gains access to our tables then they can't see the passwords.&nbsp; However, we're not encrypting it in transit, so if someone gains access to run Profiler or Extended Events then they can get the RPC Completed event that has the plain text password in it.</p>
<p>Keeping a salt in the database is still a good idea where the application can query the database to get the salt for a specific username.&nbsp; It can be used one of two ways.&nbsp; First, query the database for the salt for a specific user, use the application to encrypt the password, then query the database a second time to compare the hashed passwords.&nbsp; Second method would be to query the database for both the salt and the encrypted password and do all the comparisons in the app with that single database call.</p>
<p>This makes sense to me.&nbsp; However, I'm not a security expert and there may be reasons not to do it one of these ways.</p>
						</td>
					</tr>
					</table>
<br>


				


					<table border="0" width="100%" cellspacing="0" cellpadding="4" style="border: 1px solid #CBDCED; table-layout: fixed;">
					<tr>
						<td width="80%" bgcolor="#E8F3FF">
							<b>Friday, October 09, 2015 - 6:15:47 AM - Greg Robidoux</b>
						</td>
						<td style="text-align: right;" bgcolor="#E8F3FF">
							<a title="read the tip" href="#top">Back To Top</a>

						</td>
					</tr>
					<tr>
						<td colspan="2" class="ForumPostBodyArea">
							<p>Thanks Scott, the tip has been updated.</p>
						</td>
					</tr>
					</table>
<br>


				


					<table border="0" width="100%" cellspacing="0" cellpadding="4" style="border: 1px solid #CBDCED; table-layout: fixed;">
					<tr>
						<td width="80%" bgcolor="#E8F3FF">
							<b>Friday, October 09, 2015 - 4:45:36 AM - Scott</b>
						</td>
						<td style="text-align: right;" bgcolor="#E8F3FF">
							<a title="read the tip" href="#top">Back To Top</a>

						</td>
					</tr>
					<tr>
						<td colspan="2" class="ForumPostBodyArea">
							<p>It's a small point, but in paragraph 4 you refer to the function as HASHBITES, not HASHBYTES.</p>
						</td>
					</tr>
					</table>
<br>


				


					<table border="0" width="100%" cellspacing="0" cellpadding="4" style="border: 1px solid #CBDCED; table-layout: fixed;">
					<tr>
						<td width="80%" bgcolor="#E8F3FF">
							<b>Friday, October 09, 2015 - 3:04:06 AM - dd</b>
						</td>
						<td style="text-align: right;" bgcolor="#E8F3FF">
							<a title="read the tip" href="#top">Back To Top</a>

						</td>
					</tr>
					<tr>
						<td colspan="2" class="ForumPostBodyArea">
							<p>Doesn't SQL have bcrypt or any other crypt function? Hashing algorithms are ridiculously fast and hence are easy to brute force. For storing passwords you need a slow one way crypting algorithm like bcrypt.</p>
<p>But using sha512 is better than nothing I suppose.</p>
						</td>
					</tr>
					</table>
<br>


				


					<table border="0" width="100%" cellspacing="0" cellpadding="4" style="border: 1px solid #CBDCED; table-layout: fixed;">
					<tr>
						<td width="80%" bgcolor="#E8F3FF">
							<b>Friday, October 02, 2015 - 8:58:57 AM - Diego Miguez</b>
						</td>
						<td style="text-align: right;" bgcolor="#E8F3FF">
							<a title="read the tip" href="#top">Back To Top</a>

						</td>
					</tr>
					<tr>
						<td colspan="2" class="ForumPostBodyArea">
							<p>@Sergey / @Wayne: Ok, thank you very much for the prompt response !!</p>
						</td>
					</tr>
					</table>
<br>


				


					<table border="0" width="100%" cellspacing="0" cellpadding="4" style="border: 1px solid #CBDCED; table-layout: fixed;">
					<tr>
						<td width="80%" bgcolor="#E8F3FF">
							<b>Friday, October 02, 2015 - 4:21:28 AM - Sergey Gigoyan</b>
						</td>
						<td style="text-align: right;" bgcolor="#E8F3FF">
							<a title="read the tip" href="#top">Back To Top</a>

						</td>
					</tr>
					<tr>
						<td colspan="2" class="ForumPostBodyArea">
							<p><span style="color: #222222; font-family: arial, sans-serif; font-size: 12.8px;">Diego,</span></p>
<div style="color: #222222; font-family: arial, sans-serif; font-size: 12.8px;">Storing salt in the database with plain text is not vulnerable, because attackers can't decrypt password using salt. Password Hash is generated by applying encryption function to combination of password and salt: HASHBYTES('SHA2_512', @pPassword+CAST(@salt AS NVARCHAR(36))), so having only the salt he can't find the password.</div>
						</td>
					</tr>
					</table>
<br>


				


					<table border="0" width="100%" cellspacing="0" cellpadding="4" style="border: 1px solid #CBDCED; table-layout: fixed;">
					<tr>
						<td width="80%" bgcolor="#E8F3FF">
							<b>Thursday, October 01, 2015 - 5:11:49 PM - Wayne</b>
						</td>
						<td style="text-align: right;" bgcolor="#E8F3FF">
							<a title="read the tip" href="#top">Back To Top</a>

						</td>
					</tr>
					<tr>
						<td colspan="2" class="ForumPostBodyArea">
							<p>@Diego: I guess you need to look at the perspective of where does your system get compromised. &nbsp;The password cracking that's possible with modern machines running multiple graphics cards and multiple permutations of rainbow tables can rip apart hashes fairly easily. &nbsp;I read a recent article about the work involved in recovering Ashley Madison passwords: one security researcher had plateued when he decided to download 10,000 books from Project Gutenberg, then his recovery rate started increasing again.</p>
<p>If the data stream between users and the database server gets intercepted, they won't have access to the salt since that's hidden in the user table. &nbsp;If a copy of the database is obtained, assuming the database and the backup are not encrypted, then you're in trouble, and where the salt is stored doesn't matter.</p>
<p>Personally, I would include a pre-salt of the server name + the database name + the user name as part of the hash in addition to the GUID, I would also encrypt the salt GUID to make it harder for a hacker to figure out my process without getting my source code or forcing them to reverse-engineer my login system. &nbsp;This also means that a data thief would have to precisely duplicate environment for the database to make the password hashes usable without going to a lot of work. &nbsp;If there was a way of doing non-reversible code in T-SQL, perhaps in CLR or Powershell(?), I'd use that, I'm not familiar with using certificates with stored procs so that might be a possiblity. &nbsp;But NEVER use the encryption option on stored procedures, it's not difficult to reverse.</p>
						</td>
					</tr>
					</table>
<br>


				


					<table border="0" width="100%" cellspacing="0" cellpadding="4" style="border: 1px solid #CBDCED; table-layout: fixed;">
					<tr>
						<td width="80%" bgcolor="#E8F3FF">
							<b>Thursday, October 01, 2015 - 12:34:02 PM - Sergey Gigoyan</b>
						</td>
						<td style="text-align: right;" bgcolor="#E8F3FF">
							<a title="read the tip" href="#top">Back To Top</a>

						</td>
					</tr>
					<tr>
						<td colspan="2" class="ForumPostBodyArea">
							<p><span style="font-size: 13.3333px;">Hello&nbsp;</span><span style="font-size: 13.3333px;">Jim and Greg,</span></p>
<p><span style="font-size: 13.3333px;">I agree with you. This part of article has been already edited. Thank you for your remark and sorry for&nbsp;misunderstanding.</span></p>
						</td>
					</tr>
					</table>
<br>


				


					<table border="0" width="100%" cellspacing="0" cellpadding="4" style="border: 1px solid #CBDCED; table-layout: fixed;">
					<tr>
						<td width="80%" bgcolor="#E8F3FF">
							<b>Thursday, October 01, 2015 - 11:12:53 AM - Diego Miguez</b>
						</td>
						<td style="text-align: right;" bgcolor="#E8F3FF">
							<a title="read the tip" href="#top">Back To Top</a>

						</td>
					</tr>
					<tr>
						<td colspan="2" class="ForumPostBodyArea">
							<p>I want to know if it is good practice to store the salt in the table as a column. In this way, you are paving the way would be the attacker, is that correct?</p>
<p>If not, what other options are there?</p>
<p>Thank you.</p>
						</td>
					</tr>
					</table>
<br>


				


					<table border="0" width="100%" cellspacing="0" cellpadding="4" style="border: 1px solid #CBDCED; table-layout: fixed;">
					<tr>
						<td width="80%" bgcolor="#E8F3FF">
							<b>Tuesday, September 29, 2015 - 4:16:26 PM - Greg Robidoux</b>
						</td>
						<td style="text-align: right;" bgcolor="#E8F3FF">
							<a title="read the tip" href="#top">Back To Top</a>

						</td>
					</tr>
					<tr>
						<td colspan="2" class="ForumPostBodyArea">
							<p>I think what Jim is saying makes sense.&nbsp; If someone passes in a valid login ID and the&nbsp;correct password the system will still lookup the correct entry and allow that person access to the system.&nbsp;</p>
<p>This is probably pretty unlikely that both logins 1234 and 1243 will have the same password.</p>
						</td>
					</tr>
					</table>
<br>


				


					<table border="0" width="100%" cellspacing="0" cellpadding="4" style="border: 1px solid #CBDCED; table-layout: fixed;">
					<tr>
						<td width="80%" bgcolor="#E8F3FF">
							<b>Tuesday, September 29, 2015 - 2:25:14 PM - Jim</b>
						</td>
						<td style="text-align: right;" bgcolor="#E8F3FF">
							<a title="read the tip" href="#top">Back To Top</a>

						</td>
					</tr>
					<tr>
						<td colspan="2" class="ForumPostBodyArea">
							<p>I disagree. If at the login prompt I type "1243" as my user name (I'm "1234") and type "password" as my password, the system is going to let me in. The combination of 1243/password is a valid combination, regardless of salting. From the login prompt side of things, salting doesn't have any clue that I'm not 1243 doing a legitimate login.</p>
<p>From the database side of things, the random-ish salts do provide the added layer of defense that makes hash comparisons more difficult. Just not from the login side.</p>
						</td>
					</tr>
					</table>
<br>


				


					<table border="0" width="100%" cellspacing="0" cellpadding="4" style="border: 1px solid #CBDCED; table-layout: fixed;">
					<tr>
						<td width="80%" bgcolor="#E8F3FF">
							<b>Tuesday, September 29, 2015 - 12:47:41 PM - Sergey Gigoyan</b>
						</td>
						<td style="text-align: right;" bgcolor="#E8F3FF">
							<a title="read the tip" href="#top">Back To Top</a>

						</td>
					</tr>
					<tr>
						<td colspan="2" class="ForumPostBodyArea">
							<p><span style="font-size: 13.3333px;">Hello Jim,</span></p>
<p><span style="font-size: 13.3333px;">Yes, users have the same passwords, but thanks to salting mechanism, their password hashes are different (the salt is unique), and upon authentication we check PasswordHashes (not passwords: see dbo.uspLogin stored procedure in the article). So, wrong user can't be authenticated.</span></p>
						</td>
					</tr>
					</table>
<br>


				


					<table border="0" width="100%" cellspacing="0" cellpadding="4" style="border: 1px solid #CBDCED; table-layout: fixed;">
					<tr>
						<td width="80%" bgcolor="#E8F3FF">
							<b>Tuesday, September 29, 2015 - 9:27:43 AM - Jim</b>
						</td>
						<td style="text-align: right;" bgcolor="#E8F3FF">
							<a title="read the tip" href="#top">Back To Top</a>

						</td>
					</tr>
					<tr>
						<td colspan="2" class="ForumPostBodyArea">
							<p>One correction needs to be made to the article. If user "1234" and "1243" each have the same password, and user "1234" fat-fingers "1243" as the user name, they will be able to authenticate as the wrong user regardless of the salting mechanism used. They have the same password.</p>
<p>Otherwise, nice article.</p>
						</td>
					</tr>
					</table>
<br>


				


					<table border="0" width="100%" cellspacing="0" cellpadding="4" style="border: 1px solid #CBDCED; table-layout: fixed;">
					<tr>
						<td width="80%" bgcolor="#E8F3FF">
							<b>Tuesday, September 29, 2015 - 9:26:39 AM - Sergey Gigoyan</b>
						</td>
						<td style="text-align: right;" bgcolor="#E8F3FF">
							<a title="read the tip" href="#top">Back To Top</a>

						</td>
					</tr>
					<tr>
						<td colspan="2" class="ForumPostBodyArea">
							<p><span style="font-size: 13.3333px;">Thank you for reading Mahesh.</span></p>
						</td>
					</tr>
					</table>
<br>


				


					<table border="0" width="100%" cellspacing="0" cellpadding="4" style="border: 1px solid #CBDCED; table-layout: fixed;">
					<tr>
						<td width="80%" bgcolor="#E8F3FF">
							<b>Tuesday, September 29, 2015 - 4:15:21 AM - Mahesh</b>
						</td>
						<td style="text-align: right;" bgcolor="#E8F3FF">
							<a title="read the tip" href="#top">Back To Top</a>

						</td>
					</tr>
					<tr>
						<td colspan="2" class="ForumPostBodyArea">
							<p>Nice article thanks for give me oppurtinty to learn such things .</p>
						</td>
					</tr>
					</table>
<br>


				
		</div>
		


	</div>

	
	<aside class="large-3 hide-for-print columns">

		<a onclick="_gaq.push(['_trackEvent', 'right_image', 'Click', 'Webcast']);" href="https://www.mssqltips.com/webcastSignupPage.asp?id=579&src=300x30" target="_blank"><img src="/images/webcast_next.png"></a><br /><br /><br /><br /><br /><br />

		<script language = "Javascript">
function ValidateEmail(){
	var emailID=document.optin.ea
	
	if ((emailID.value==null)||(emailID.value=="")||(emailID.value=="enter email address")){
		alert("Please Enter your Email")
		emailID.focus()
		return false
	}
	if (echeck2(emailID.value)==false){
		emailID.focus()
		return false
	}
	return true
 }
</script>



	<div id="search-div" style="height:300px;">
		<div id="signup-div">
		<div style="text-align: center;"><a href="/get-free-sql-server-tips/?ref=LeftGFSTSlant"><img border="0" src="/images/MSSQLTips_LeftForm_V3_20160929.png"  ></a></div>

			<form action="/get-free-sql-server-tips/" method="post" name="optin" onsubmit="return ValidateEmail()">
				<div style="text-align: center;">
					<input name="URL" type="hidden" value="leftform" />
					<input name="ReferralURL" type="hidden" value="" />
					<input size="25" type="text" onblur="if (this.value=='') this.value=this.defaultValue" onclick="if (this.defaultValue==this.value) this.value=''" value="enter email address" name="ea">
					<input type="submit" name="Button1" value="Join" />
				</div>
			</form>
		</div>
	</div>
<!-- 160x600-Primary -->
<div align="center">
	<div id='div-gpt-ad-1388505177750-0' style='width:160px; height:800px;'>
	<script type='text/javascript'>
	googletag.cmd.push(function() { googletag.display('div-gpt-ad-1388505177750-0'); });
	</script>
	</div>
</div><!-- 300x250-Primary -->
<div align="center">
	<div id='div-gpt-ad-1388505177750-2' style='width:300px; height:450px;'>
	<script type='text/javascript'>
	googletag.cmd.push(function() { googletag.display('div-gpt-ad-1388505177750-2'); });
	</script>
	</div>
</div><!-- 160x600-Secondary -->
<div align="center">
	<div id='div-gpt-ad-1388505177750-1' style='width:160px; height:800px;'>
	<script type='text/javascript'>
	googletag.cmd.push(function() { googletag.display('div-gpt-ad-1388505177750-1'); });
	</script>
	</div>
</div>	<!-- 300x250-Secondary -->
<div id="sticky-anchor"></div>
<div id="sticky" align="center">
	<div id='div-gpt-ad-1388505177750-3' style='width:300px; height:250px;'>
	<script type='text/javascript'>
	googletag.cmd.push(function() { googletag.display('div-gpt-ad-1388505177750-3'); });
	</script>
	</div>
</div>	
    </aside>
    

</div>


<footer class="row">
<div class="large-12 columns">
	<hr />
	<div class="row hide-for-print">
		<div class="large-2 medium-3 columns hide-for-small">
			<h3><span style="color:#3B6D93">Follow</span></h3>
			<a href="/get-free-sql-server-tips/?ref=GetFooterMenu">Get Free SQL Tips</a><br /><br />
			<a href="https://twitter.com/mssqltips" target="_blank">Twitter</a><br /><br />
			<a href="https://www.linkedin.com/grp/home?gid=2320891" target="_blank">LinkedIn</a><br /><br />
			<a href="https://plus.google.com/+Mssqltips_est_2006/posts" target="_blank">Google+</a><br /><br />
			<a href="https://www.facebook.com/pages/MSSQLTips/155636491141708" target="_blank">Facebook</a><br /><br />
			<a href="https://www.pinterest.com/mssqltips/" target="_blank">Pinterest</a><br /><br />
			<a href="https://feeds.feedburner.com/MSSQLTips-LatestSqlServerTips" target="_blank">RSS</a><br />
		</div>
		
		<div class="large-2 medium-3 small-6 columns">
			<h3><span style="color:#3B6D93">Learning</span></h3>
			<a href="/sql-server-dba-resources/">DBAs</a><br /><br />
			<a href="/sql-server-developer-resources/">Developers</a><br /><br />
			<a href="/sql-server-business-intelligence-resources/">BI Professionals</a><br /><br />
			<a href="/sql-server-professional-development-resources/">Careers</a><br /><br />
			<a href="http://sqlserverquestions.mssqltips.com/questionlist.asp">Q and A</a><br /><br />
			<a href="/todays-sql-server-tip/">Today's Tip</a><br />
		</div>	

		<div class="large-2 medium-3 small-6 columns">
			<h3><span style="color:#3B6D93">Resources</span></h3>
			<a href="/sql-server-tutorials/">Tutorials</a><br /><br />
			<a href="/sql-server-webcasts/">Webcasts</a><br /><br />
			<a href="/sql-server-whitepapers/">Whitepapers</a><br /><br />
			<a href="/sql-server-tools/">Tools</a><br /><br />
		</div>
		
		<div class="large-2 medium-3 columns hide-for-small">
			<h3><span style="color:#3B6D93">Search</span></h3>
			<a href="/sql-server-categories/">Tip Categories</a><br /><br />
			<a href="/search-tip-id/">Search By TipID</a><br /><br />
			<a href="/sql-server-mssqltips-authors/">Authors</a><br />
		</div>
		
		<div class="large-2 hide-for-medium columns hide-for-small">
			<h3><span style="color:#3B6D93">Community</span></h3>
			<a href="/learn-more-about-mssqltips/">First Timer?</a><br /><br />
			<a href="/mssqltips-community/1/">Pictures</a><br /><br />
			<a href="/contribute/">Contribute</a><br /><br />
			<a href="/sql-server-event-list/">Events</a><br /><br />
			<a href="/sql-server-user-groups/">User Groups</a><br /><br />
			<a href="/mssqltips-author-of-year/">Author of the Year</a><br /><br />
		</div>
		
		<div class="large-2 hide-for-medium columns hide-for-small">
			<h3><span style="color:#3B6D93">More Info</span></h3>
			<a href="/get-free-sql-server-tips/?ref=JoinFooterMenu">Join</a><br /><br />
			<a href="/about/">About</a><br /><br />
			<a href="/copyright/">Copyright</a><br /><br />
			<a href="/privacy/">Privacy</a><br /><br />
			<a href="/disclaimer/">Disclaimer</a><br /><br />
			<a href="/feedback/">Feedback</a><br /><br />
			<a href="/advertise/">Advertise</a><br />
		</div>
	</div>
	<hr />
	<div class="row">
		<div class="large-12 columns text-center">
			<p>Copyright (c) 2006-2016 <a href="https://www.edgewoodsolutions.com">Edgewood Solutions, LLC</a> All rights reserved<br />
			<small>Some names and products listed are the registered trademarks of their respective owners.</small></p>
		</div>
	</div>
</div>
</footer>


<!-- dropdown 990x30 -->
<style type="text/css">
#slideboxtop{
    width:100%;
    height:50px;
    padding:10px;
    background-color:#FFFFFF;
    border-bottom:1px solid #000000;
    position:fixed;
    top: -250px;
	-moz-box-shadow:-2px 0px 5px #aaa;
	-webkit-box-shadow:-2px 0px 5px #aaa;
/* 	box-shadow:-2px 0px 5px #aaa;    */
}
</style>

<div class="hide-for-small hide-for-medium hide-for-print">
	<div id="slideboxtop" style="z-index:99;">
		<div style="text-align:center">
			<a onclick="_gaq.push(['_trackEvent', '990x30', 'Click', 'Dropdown']);" target="_blank" href="/ss.asp?id=3112&link=https://ad.doubleclick.net/ddm/clk/314044174;141836618;b"><img src="https://www.mssqltips.com/absolutebm/banners/MSSQLTips_Webcast_20161122_990x30.png" border="0" height="30" width="990" alt="Learn more about SQL Server tools"></a>
		</div>
	</div>
</div>


<script type="text/javascript">
$(function() {
	$(window).scroll(function(){
		if  ($(window).scrollTop() > 250)
			$('#slideboxtop').animate({'top':'0px'});
		else
			$('#slideboxtop').stop(true).animate({'top':'-250px'});
	});
});
</script>


<!-- sticky 300x250 -->
<style type="text/css">
#sticky {
    padding: 0ex;
    width: 300px;
    background-color: #fff;
}

#sticky.stick {
    margin-top: 75px !important;
    position: fixed;
    top: 0;
    z-index: 10000;
}
</style>

<script type="text/javascript">
function sticky_relocate() {
    var window_top = $(window).scrollTop();
    var div_top = $('#sticky-anchor').offset().top;
    var window_width = $(window).width();
    var window_height = $(window).height();
    if (window_top > div_top && window_width > 1100 && window_height > 400 ) {
        $('#sticky').addClass('stick');
        $('#sticky-anchor').height($('#sticky').outerHeight());
    } else {
        $('#sticky').removeClass('stick');
        $('#sticky-anchor').height(0);
    }
}

$(function() {
    $(window).scroll(sticky_relocate);
    sticky_relocate();
});

</script>

<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-910745-2']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>


</body>
</html>
